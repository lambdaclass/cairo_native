<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Cairo Sierra to MLIR compiler and JIT engine"><title>cairo_native - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-081576b923113409.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="cairo_native" data-themes="" data-resource-suffix="" data-rustdoc-version="1.79.0 (129f3b996 2024-06-10)" data-channel="1.79.0" data-search-js="search-bf21c90c8c1d92b1.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-e32f0c247825364d.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../cairo_native/index.html">cairo_native</a><span class="version">0.2.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../cairo_native/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type ‘S’ or ‘/’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">cairo_native</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/cairo_native/lib.rs.html#1-117">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="cairo-sierra-to-mlir-compiler-and-jit-engine"><a class="doc-anchor" href="#cairo-sierra-to-mlir-compiler-and-jit-engine">§</a>Cairo Sierra to MLIR compiler and JIT engine</h2>
<p>This crate is a compiler and JIT engine that transforms Sierra (or Cairo) sources into MLIR,
which can be <a href="https://en.wikipedia.org/wiki/Just-in-time_compilation">JIT-executed</a> or further
compiled into a binary
<a href="https://en.wikipedia.org/wiki/Ahead-of-time_compilation">ahead of time</a>.</p>
<h3 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h3>
<p>The API contains two structs, <code>NativeContext</code> and <code>NativeExecutor</code>.
The main purpose of <code>NativeContext</code> is MLIR initialization, compilation and lowering to LLVM.
<code>NativeExecutor</code> in the other hand is responsible of executing MLIR compiled sierra programs
from an entrypoint.
Programs and JIT states can be cached in contexts where their execution will be done multiple
times.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>starknet_types_core::felt::Felt;
<span class="kw">use </span>cairo_native::context::NativeContext;
<span class="kw">use </span>cairo_native::executor::JitNativeExecutor;
<span class="kw">use </span>cairo_native::values::JitValue;
<span class="kw">use </span>std::path::Path;

<span class="kw">let </span>program_path = Path::new(<span class="string">"programs/examples/hello.cairo"</span>);
<span class="comment">// Compile the cairo program to sierra.
</span><span class="kw">let </span>sierra_program = cairo_native::utils::cairo_to_sierra(program_path);

<span class="comment">// Instantiate a Cairo Native MLIR context. This data structure is responsible for the MLIR
// initialization and compilation of sierra programs into a MLIR module.
</span><span class="kw">let </span>native_context = NativeContext::new();

<span class="comment">// Compile the sierra program into a MLIR module.
</span><span class="kw">let </span>native_program = native_context.compile(<span class="kw-2">&amp;</span>sierra_program, <span class="prelude-val">None</span>).unwrap();

<span class="comment">// The parameters of the entry point.
</span><span class="kw">let </span>params = <span class="kw-2">&amp;</span>[JitValue::Felt252(Felt::from_bytes_be_slice(<span class="string">b"user"</span>))];

<span class="comment">// Find the entry point id by its name.
</span><span class="kw">let </span>entry_point = <span class="string">"hello::hello::greet"</span>;
<span class="kw">let </span>entry_point_id = cairo_native::utils::find_function_id(<span class="kw-2">&amp;</span>sierra_program, entry_point);

<span class="comment">// Instantiate the executor.
</span><span class="kw">let </span>native_executor = JitNativeExecutor::from_native_module(native_program, Default::default());

<span class="comment">// Execute the program.
</span><span class="kw">let </span>result = native_executor
    .invoke_dynamic(entry_point_id, params, <span class="prelude-val">None</span>)
    .unwrap();

<span class="macro">println!</span>(<span class="string">"Cairo program was compiled and executed successfully."</span>);
<span class="macro">println!</span>(<span class="string">"{:?}"</span>, result);</code></pre></div>
<h3 id="common-definitions"><a class="doc-anchor" href="#common-definitions">§</a>Common definitions</h3>
<p>Within this project there are lots of functions with the same signature. As their arguments have
all the same meaning, they are documented here:</p>
<ul>
<li><code>context: NativeContext</code>: The MLIR context.</li>
<li><code>module: &amp;NativeModule</code>: The compiled MLIR program, with other relevant information such as program registry and metadata.</li>
<li><code>program: &amp;Program</code>: The Sierra input program.</li>
<li><code>registry: &amp;ProgramRegistry&lt;TType, TLibfunc&gt;</code>: The registry extracted from the program.</li>
<li><code>metadata: &amp;mut MetadataStorage</code>: Current compiler metadata.</li>
</ul>
<h3 id="project-layout"><a class="doc-anchor" href="#project-layout">§</a>Project layout</h3><div class="example-wrap"><pre class="language-txt"><code> src
 ├─ context.rs - The MLIR context wrapper, provides the compile method.
 ├─ utils.rs - Internal utilities.
 ├─ metadata/ - Metadata injector to use within the compilation process
 ├─ executor/ - Code related to the executor of programs.
 ├─ module.rs - The MLIR module wrapper.
 ├─ arch/ - Trampoline assembly for calling functions with dynamic signatures.
 ├─ executor.rs - The executor code.
 ├─ ffi.cpp - Missing FFI C wrappers
 ├─ libfuncs - Cairo Sierra libfunc implementations
 ├─ libfuncs.rs - Cairo Sierra libfunc glue code
 ├─ starknet.rs - Starknet syscall handler glue code.
 ├─ ffi.rs - Missing FFI C wrappers, rust side.
 ├─ block_ext.rs - A melior (MLIR) block trait extension to write less code.
 ├─ lib.rs - The main lib file.
 ├─ execution_result.rs - Program result parsing.
 ├─ values.rs - JIT serialization.
 ├─ metadata.rs - Metadata injector to use within the compilation process.
 ├─ compiler.rs - The glue code of the compiler, has the codegen for the function signatures
 and calls the libfunc codegen implementations.
 ├─ error.rs - Error handling
 ├─ bin - Binary programs
 ├─ types - Cairo to MLIR type information
</code></pre></div></div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="cache/index.html" title="mod cairo_native::cache">cache</a></div></li><li><div class="item-name"><a class="mod" href="context/index.html" title="mod cairo_native::context">context</a></div></li><li><div class="item-name"><a class="mod" href="debug_info/index.html" title="mod cairo_native::debug_info">debug_info</a></div><div class="desc docblock-short">Extracts useful debugging information from cairo programs to make it available to the generated MLIR.</div></li><li><div class="item-name"><a class="mod" href="error/index.html" title="mod cairo_native::error">error</a></div><div class="desc docblock-short">Various error types used thorough the crate.</div></li><li><div class="item-name"><a class="mod" href="execution_result/index.html" title="mod cairo_native::execution_result">execution_result</a></div></li><li><div class="item-name"><a class="mod" href="executor/index.html" title="mod cairo_native::executor">executor</a></div><div class="desc docblock-short">Executors</div></li><li><div class="item-name"><a class="mod" href="libfuncs/index.html" title="mod cairo_native::libfuncs">libfuncs</a></div><div class="desc docblock-short">Compiler libfunc infrastructure</div></li><li><div class="item-name"><a class="mod" href="metadata/index.html" title="mod cairo_native::metadata">metadata</a></div><div class="desc docblock-short">Code generation metadata</div></li><li><div class="item-name"><a class="mod" href="module/index.html" title="mod cairo_native::module">module</a></div></li><li><div class="item-name"><a class="mod" href="starknet/index.html" title="mod cairo_native::starknet">starknet</a></div><div class="desc docblock-short">Starknet related code for <code>cairo_native</code></div></li><li><div class="item-name"><a class="mod" href="starknet_stub/index.html" title="mod cairo_native::starknet_stub">starknet_stub</a></div><div class="desc docblock-short">A (somewhat) usable implementation of the starknet syscall handler trait.</div></li><li><div class="item-name"><a class="mod" href="types/index.html" title="mod cairo_native::types">types</a></div><div class="desc docblock-short">Compiler type infrastructure</div></li><li><div class="item-name"><a class="mod" href="utils/index.html" title="mod cairo_native::utils">utils</a></div><div class="desc docblock-short">Various utilities</div></li><li><div class="item-name"><a class="mod" href="values/index.html" title="mod cairo_native::values">values</a></div><div class="desc docblock-short">JIT params and return values de/serialization</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.LLVMCompileError.html" title="struct cairo_native::LLVMCompileError">LLVMCompileError</a></div><div class="desc docblock-short">A error from the LLVM API.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.OptLevel.html" title="enum cairo_native::OptLevel">OptLevel</a></div><div class="desc docblock-short">Optimization levels.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.compile.html" title="fn cairo_native::compile">compile</a></div><div class="desc docblock-short">Run the compiler on a program. The compiled program is stored in the MLIR module.</div></li><li><div class="item-name"><a class="fn" href="fn.module_to_object.html" title="fn cairo_native::module_to_object">module_to_object</a></div><div class="desc docblock-short">Converts a MLIR module to a compile object, that can be linked with a linker.</div></li><li><div class="item-name"><a class="fn" href="fn.object_to_shared_lib.html" title="fn cairo_native::object_to_shared_lib">object_to_shared_lib</a></div><div class="desc docblock-short">Links the passed object into a shared library, stored on the given path.</div></li></ul></section></div></main></body></html>