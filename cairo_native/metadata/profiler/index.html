<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The libfunc profiling feature is used to generate information about every libfunc executed in a sierra program."><title>cairo_native::metadata::profiler - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-84e720fa.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="cairo_native" data-themes="" data-resource-suffix="" data-rustdoc-version="1.89.0 (29483883e 2025-08-04)" data-channel="1.89.0" data-search-js="search-92309212.js" data-settings-js="settings-5514c975.js" ><script src="../../../static.files/storage-4e99c027.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-fd3af306.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../cairo_native/index.html">cairo_<wbr>native</a><span class="version">0.8.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module profiler</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#statics" title="Statics">Statics</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In cairo_<wbr>native::<wbr>metadata</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">cairo_native</a>::<wbr><a href="../index.html">metadata</a></div><h1>Module <span>profiler</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/cairo_native/metadata/profiler.rs.html#1-411">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The libfunc profiling feature is used to generate information about every libfunc executed in a sierra program.</p>
<p>When this feature is used, the compiler will call the important methods:</p>
<ol>
<li>
<p><code>measure_timestamp</code>: called before every libfunc execution.</p>
</li>
<li>
<p><code>push_frame</code>: called before every branching operation. This method will also call <code>measure_timestamp</code>. This,
with the timestamp calculated before the execution, will allow to measure each statement’s execution time.
If for some reason, the statement delta time could not be gathered, we just record an unit value, recording that
we executed the given statement.</p>
</li>
</ol>
<p>Once the program execution finished and the information was gathered, the <code>get_profile</code> method can be called.
It groups the samples by libfunc, and returns all data related to each libfunc.</p>
<p>As well as with the trace-dump feature, in the context of Starknet contracts, we need to add support for building
profiles for multiple executions. To do so, we need two important elements, which must be set before every contract
execution:</p>
<ol>
<li>
<p>A global static hashmap to map every profile ID to its respective profiler. See <code>LIBFUNC_PROFILE</code>.</p>
</li>
<li>
<p>A counter to track the ID of the current profiler, which gets updated every time we switch to another
contract. Since a contract can call other contracts, we need a way of restoring the counter after every execution.</p>
</li>
</ol>
<p>See <code>cairo-native-run</code> for an example on how to do it.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.LibfuncProfileData.html" title="struct cairo_native::metadata::profiler::LibfuncProfileData">Libfunc<wbr>Profile<wbr>Data</a></dt><dd>Represents the profile data for a particular libfunc.</dd><dt><a class="struct" href="struct.ProfilerImpl.html" title="struct cairo_native::metadata::profiler::ProfilerImpl">Profiler<wbr>Impl</a></dt><dt><a class="struct" href="struct.ProfilerMeta.html" title="struct cairo_native::metadata::profiler::ProfilerMeta">Profiler<wbr>Meta</a></dt></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.ProfilerBinding.html" title="enum cairo_native::metadata::profiler::ProfilerBinding">Profiler<wbr>Binding</a></dt></dl><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">§</a></h2><dl class="item-table"><dt><a class="static" href="static.LIBFUNC_PROFILE.html" title="static cairo_native::metadata::profiler::LIBFUNC_PROFILE">LIBFUNC_<wbr>PROFILE</a></dt></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.setup_runtime.html" title="fn cairo_native::metadata::profiler::setup_runtime">setup_<wbr>runtime</a></dt></dl></section></div></main></body></html>